<%- include('../blocks/header') %>
<link rel="stylesheet" href="/css/file-directory.css" type="text/css">
<div id="wrapper">
  <!-- Sidebar -->
  <%- include('../blocks/sidebar', { size: files.size, formatBytes }) %>
  <div class="container-fluid" style="padding:0px 30px 0px;">
    &nbsp;
    <%- include('../partials/message', { error })%>
    <div class="row">
      <div class="col-sm-10">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/files">Home</a></li>
            <% for (var name of path.split('/').slice(2, path.length)) { %>
              <li class="breadcrumb-item active">
                <a href=<%= `/${path.split('/').slice(1, path.split('/').indexOf(name)+1).join('/')}` %>><%= name%></a>
              </li>
            <% } %>
          </ol>
        </nav>
      </div>
      <div class="col-sm-2">
        <div class="btn-group" style="float:right">
          <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Upload</button>
          <div class="dropdown-menu dropdown-menu-right">
            <form action="/files/upload" method="post" encType="multipart/form-data" ref='uploadForm' id='uploadForm' >
              <label class="dropdown-item" type="button" id="fileHover">
                Files<input type="file" hidden name="sampleFile" onChange="javascript:document.getElementById('imagefile').click();" />
              </label>
              <input type="hidden" value="<%= path%>" name="path">
              <label class="dropdown-item" type="button" id="fileHover">
                Folders<input type="file" hidden name="sampleFile" webkitdirectory mozdirectory onChange="javascript:document.getElementById('imagefile').click();" />
              </label>
              <button type="submit" style="display:none;" id="imagefile"></button>
            </form>
          </div>
        </div>
      </div>
    </div>
    &nbsp
    <table class="table" id="myTable">
      <thead>
        <tr onClick="updateAll();">
          <th scope="col" style="width:5%" class="dot">
            <a type="button" class="hide" data-toggle="tooltip" data-placement="top" title="Toggle selection for all items">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="exampleRadios" id="All" value="option2">
              </div>
            </a>
          </th>
          <th id="Name" scope="col">Name</th>
          <th id="Size" scope="col">Size</th>
          <th id="Date modified" scope="col">Date modified</th>
        </tr>
      </thead>
      <tbody>
        <!--Show folders first-->
        <% for (const file of files.children.filter(file => file.type == 'directory')) { %>
          <tr>
            <th class="dot">
              <div class="form-check form-check-inline hide">
                <input class="form-check-input" type="checkbox" name="exampleRadios" id="exampleRadios2" value="option2">
              </div>
            </th>
            <th scope="row" class="text-truncate" style="min-width: 150px;">
              <a href="<%= decodeURI(`${path == '/' ? '/files' : path}/${file.name}`) %>"><%= file.name %></a>
              <!-- Default dropright button -->
              <div class="btn-group dropright">
                <button type="button" class="btn btn-secondary">
                  Split dropright
                </button>
                <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-boundary="scrollParent">
                  <span class="sr-only">Toggle Dropright</span>
                </button>
                <div class="dropdown-menu">
                  <p>Test</p>
                  <p>Test</p>
                  <p>Test</p>
                  <p>Test</p>
                </div>
              </div>
            </th>
            <td><%= file.children?.length ?? 0 %> files</td>
            <td><%= file.modified?.toDateString() %></td>
          </tr>
        <% } %>
        <% for (const file of files.children.filter(file => file.type == 'file')) { %>
          <tr onClick="updateValue('<%= encodeURI(file.name) %>');">
            <th class="dot">
              <div class="form-check form-check-inline hide">
                <input onclick="updateValue('<%= encodeURI(file.name) %>');" class="form-check-input" type="checkbox" name="exampleRadios" id="<%= encodeURI(file.name) %>" value="option2">
              </div>
            </th>
            <th scope="row" class="text-truncate" style="max-width: 150px;"> <a href="<%= decodeURI(`${path == '/' ? '/files' : path}/${file.name}`) %>"><%= file.name %></a></th>
            <td><%= formatBytes(file.size) %></td>
            <td><%= file.modified?.toDateString() %></td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
<script type="text/javascript" src="/js/file-directory.js"></script>
